# PLAN-GPTs — GPTs 連携ワンクリック送信 機能要件

## 1. 背景
- 文字起こしジョブ完了後のトランスクリプトを、ユーザーがファインチューニングした ChatGPT GPTs（Revoice Supporter）へ即座に送りたい。
- 現状は手動でコピー＆ブラウザを開く必要がある。
- Electron アプリからワンクリックでクリップボードコピー＋ブラウザ起動を行えるようにし、ワークフローを簡素化する。

## 2. 目標
- 任意のタブ／ジョブのトランスクリプトを「GPTsで開く」ボタンから即利用できる。
- ブラウザを自動で指定 URL（`https://chatgpt.com/g/g-68df6cd0042c8191a2e8adf4717400b0-revoice-supporter`）に開き、同時にトランスクリプトをクリップボードへコピーしておく。

## 3. 利用シナリオ
1. 文字起こしタブでジョブが完了 → トランスクリプトがリスト化される。
2. ユーザーが「GPTsで開く」ボタンをクリック。
3. Electron が
   1. トランスクリプト全文をクリップボードにコピー。
   2. クリップボード書き込みの成功を UI ログで通知。
   3. 既定ブラウザで GPTs のリンクを開く。
4. ユーザーは開いた GPTs に貼り付け（⌘V）するだけでトランスクリプトを送信できる。

## 4. 機能要件
### 4.1 UI
- 文字起こしタブの結果パネルに「GPTsで開く」ボタンを追加（タブ毎）。
- 履歴詳細ビューにも同等のボタンを配置し、過去結果からも送信できるようにする（任意）。
- ボタンホバー時は「クリップボードにコピーしてGPTsを開く」旨のツールチップ。

### 4.2 挙動
- ボタン押下後に以下を順番に処理する。
  1. `clipboard.writeText(transcript)` を実行。
  2. 成功時 `[SYSTEM] Transcript copied for GPTs` を `jobs:event` ログに出力。
  3. `shell.openExternal(GPTS_URL)` でブラウザ起動。
  4. 失敗時はログに `[ERROR]` を出し、トースト表示。
- 非同期処理中はボタンをローディング状態にし、連打を防ぐ。

### 4.3 IPC / セキュリティ
- `preload.js` に `copyToClipboard(text: string)` と `openExternal(url: string)` を追加。
- main プロセス側で許可する URL をホワイトリスト（GPTs リンク）に限定し、他の URL への任意オープンを防止。
- クリップボード書き込みはレンダラーから直接行わず、IPC 経由で main → Electron `clipboard` とする。

### 4.4 ロギング
- クリップボード書き込み／ブラウザ起動に成功したら `[SYSTEM] GPTs helper ready` ログをタブのログタイムラインへ送信。
- 失敗時の詳細エラーも `[ERROR] GPTs helper failed: ...` で通知。

### 4.5 永続化
- すでに `job.metadata.transcript` が保存されているため、再起動後もタブから送信ボタンが使えること。
- ボタン表示条件: `tab.transcript !== ''` もしくは `job.metadata.transcript` が存在すること。

## 5. 非機能要件
- クリップボード書き換えはユーザー操作（ボタン押下）に限定し、自動では行わない。
- 処理全体は100ms程度で完了する想定。失敗時リトライはしない。
- macOS / Windows / Linux の既定ブラウザ起動で動作確認。

## 6. 作業項目
1. preload: `copyToClipboard`, `openExternal` IPC 追加。
2. main: 上記 IPC の処理を実装（URL 検証、ログ出力）。
3. renderer: ボタン UI 追加、ローディング状態とエラーハンドリング実装。
4. renderer: タブ結果と履歴詳細にボタンを配置。
5. テスト: クリップボード書き込みの成否ログ確認、ブラウザ起動確認。
6. ドキュメント: `PLAN.md` への追記、ユーザーハンドブック更新。

## 7. 未解決事項 / オープン質問
- 自動で GPTs にテキストを POST する術は現状なし（ブラウザオートメーションは scope 外）。→ 貼り付け運用で合意済みか要確認。
- 履歴側にもボタンを置くべきか？（ヒストリービューでの UX を決定する）
- 複数タブ同時利用時、どのタブに対する成功ログを出すかの整合性（タブIDで紐付ければ良い）。

## 8. 参考 URL
- GPTs: https://chatgpt.com/g/g-68df6cd0042c8191a2e8adf4717400b0-revoice-supporter

---
この計画をもとに実装を進める。
